<!DOCTYPE html>
<html>

<head>

<title>Sensor Watch Builder</title>

<script>
function dragstart_handler(ev) {
  ev.dataTransfer.setData("text/plain", ev.target.id)
  ev.dataTransfer.dropEffect = "copy"
}

function dragover_handler(ev) {
  ev.preventDefault()
}

function drop_handler(ev) {
  ev.preventDefault()
  const dropped = event.dataTransfer.getData("text/plain")
  const el = document.createElement("option")
  el.selected = true
  el.value = dropped
  el.append(document.createTextNode(dropped))
  el.addEventListener("mousedown", (ev) => ev.preventDefault())
  ev.target.append(el)
}

window.addEventListener("DOMContentLoaded", () => {
  document.getElementById("js-section").hidden = false
  const available_faces = document.getElementById("available_faces")

  for (const option of document.querySelectorAll("#faces > option")) {
    const el = document.createElement("button")
    el.id = option.value
    el.draggable = true
    el.innerHTML = option.innerHTML
    el.addEventListener("dragstart", dragstart_handler)
    available_faces.append(el)
  }

  for (const option of document.querySelectorAll(".facetarget > option")) {
    option.remove()
  }

  for (const face_target of document.querySelectorAll(".facetarget")) {
    face_target.addEventListener("drop", drop_handler)
    face_target.addEventListener("dragover", dragover_handler)
  }

  const clear_button = document.getElementById("clear")
  clear_button.hidden = false
  clear_button.addEventListener("click", () => {
    for (const option of document.querySelectorAll(".facetarget > option")) {
      option.remove()
    }
  })
})
</script>

<style>
main {
  display: grid;
  grid-template-columns: 30% 30% 40%;
}

select {
  width: 90%;
  font-size: large;
}

#available_faces > button {
  padding: 5px;
  margin: 5px;
  font-size: large;
}

#faces {
  height: 350px;
}

#secondary_faces {
  height: 350px;
}

.action-buttons {
  padding: 5px;
  margin: 10px;
  font-size: x-large;
}
</style>

</head>

<body>


<section>
<h1>Sensor Watch Builder</h1>

<p>Build firmware for the <a href="https://sensorwatch.net/">Sensor Watch</a> online. Experimental.
<a href="https://github.com/wryun/sensor-watch-builder/">Source code on GitHub</a>.
</section>

<main>
<section id="js-section" hidden>
<h3>Drag faces from here...</h3>
<div name="available_faces" id="available_faces" multiple required>
</div>
</section>

<section>
<h3>Selected faces...</h3>

<form action="/build" method="post">
<h5><label for="faces">Faces</label></h5>
<p>
<select class="facetarget" name="faces" id="faces" multiple required>
<option value="simple_clock_face" selected>simple_clock_face</option>
<option value="world_clock_face" selected>world_clock_face</option>
<option value="preferences_face">preferences_face</option>
<option value="set_time_face">set_time_face</option>
<option value="pulsometer_face">pulsometer_face</option>
<option value="thermistor_readout_face">thermistor_readout_face</option>
<option value="thermistor_logging_face">thermistor_logging_face</option>
<option value="thermistor_testing_face">thermistor_testing_face</option>
<option value="character_set_face">character_set_face</option>
<option value="beats_face">beats_face</option>
<option value="day_one_face">day_one_face</option>
<option value="voltage_face">voltage_face</option>
<option value="stopwatch_face">stopwatch_face</option>
<option value="totp_face">totp_face</option>
<option value="totp_face_lfs">totp_face_lfs</option>
<option value="lis2dw_logging_face">lis2dw_logging_face</option>
<option value="demo_face">demo_face</option>
<option value="hello_there_face">hello_there_face</option>
<option value="sunrise_sunset_face">sunrise_sunset_face</option>
<option value="countdown_face">countdown_face</option>
<option value="counter_face">counter_face</option>
<option value="blinky_face">blinky_face</option>
<option value="moon_phase_face">moon_phase_face</option>
<option value="accelerometer_data_acquisition_face">accelerometer_data_acquisition_face</option>
<option value="mars_time_face">mars_time_face</option>
<option value="orrery_face">orrery_face</option>
<option value="astronomy_face">astronomy_face</option>
<option value="tomato_face">tomato_face</option>
<option value="probability_face">probability_face</option>
<option value="wake_face">wake_face</option>
<option value="frequency_correction_face">frequency_correction_face</option>
<option value="alarm_face">alarm_face</option>
<option value="ratemeter_face">ratemeter_face</option>
</select>

<h5><label for="secondary_faces">Secondary Faces</label></h5>
<p>
<select class="facetarget" name="secondary_faces" id="secondary_faces" multiple>
<option value="simple_clock_face">simple_clock_face</option>
<option value="world_clock_face">world_clock_face</option>
<option value="preferences_face" selected>preferences_face</option>
<option value="set_time_face" selected>set_time_face</option>
<option value="pulsometer_face">pulsometer_face</option>
<option value="thermistor_readout_face">thermistor_readout_face</option>
<option value="thermistor_logging_face">thermistor_logging_face</option>
<option value="thermistor_testing_face">thermistor_testing_face</option>
<option value="character_set_face">character_set_face</option>
<option value="beats_face">beats_face</option>
<option value="day_one_face">day_one_face</option>
<option value="voltage_face">voltage_face</option>
<option value="stopwatch_face">stopwatch_face</option>
<option value="totp_face">totp_face</option>
<option value="totp_face_lfs">totp_face_lfs</option>
<option value="lis2dw_logging_face">lis2dw_logging_face</option>
<option value="demo_face">demo_face</option>
<option value="hello_there_face">hello_there_face</option>
<option value="sunrise_sunset_face">sunrise_sunset_face</option>
<option value="countdown_face">countdown_face</option>
<option value="counter_face">counter_face</option>
<option value="blinky_face">blinky_face</option>
<option value="moon_phase_face">moon_phase_face</option>
<option value="accelerometer_data_acquisition_face">accelerometer_data_acquisition_face</option>
<option value="mars_time_face">mars_time_face</option>
<option value="orrery_face">orrery_face</option>
<option value="astronomy_face">astronomy_face</option>
<option value="tomato_face">tomato_face</option>
<option value="probability_face">probability_face</option>
<option value="wake_face">wake_face</option>
<option value="frequency_correction_face">frequency_correction_face</option>
<option value="alarm_face">alarm_face</option>
<option value="ratemeter_face">ratemeter_face</option>
</select>

<p>
<button class="action-buttons" id="clear" hidden>Clear</button>
<input class="action-buttons" type="submit" id="build" value="Build a watch!">

</form>
</section>

<section>

<h2>Previous builds</h2>
<ul>
    <!--# include file="/builds/list.html" -->
</ul>
</section>


</main>

</body>
</html>
